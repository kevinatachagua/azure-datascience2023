{
	"name": "CopiaBusiness",
	"properties": {
		"content": {
			"query": " CREATE DATABASE updatalakehouse_business;\nGO\n\nUSE updatalakehouse_business;\nGO\n\n-----------------------------------------------\n--Paso 2: Creacion de dataset por zona de datos\n-----------------------------------------------\nCREATE SCHEMA master_transaction AUTHORIZATION dbo;\nGO\n\nCREATE SCHEMA master_channel AUTHORIZATION dbo;\nGO\n\nCREATE SCHEMA master_party AUTHORIZATION dbo;\nGO\n\nCREATE SCHEMA business_knowa AUTHORIZATION dbo;\nGO\n\n-------------------------------------------------------------------------\n--Paso 3: Asignación de clave de encriptación y formato de tablas externas\n-------------------------------------------------------------------------\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = 'p39248J#asdasdiu89yuj1k29sdd'\nGO\n\nCREATE DATABASE SCOPED CREDENTIAL UPUserIdentity WITH IDENTITY = 'SHARED ACCESS SIGNATURE',\nSECRET = '?sv=2021-12-02&ss=bfqt&srt=sco&sp=rwdlacupyx&se=2023-06-30T10:47:11Z&st=2023-04-30T02:47:11Z&spr=https&sig=ezJCBxXXS9BCWwv3OA4CRL7y7BVfumdfdnE0VrqPlGE%3D'\nGO\n\nCREATE EXTERNAL DATA SOURCE ExternalUPDataSource\nWITH (\n    LOCATION = 'https://dlsupdskuafdevi5l.dfs.core.windows.net/',\n    CREDENTIAL = UPUserIdentity\n);\nGO\n\nCREATE EXTERNAL FILE FORMAT UPParquetFileFormat \nWITH (\n    FORMAT_TYPE = PARQUET,\n    DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'\n);\nGO\n\n-------------------------------------------------------------------------\n--Paso 4: Copia de Master a Business\n-------------------------------------------------------------------------\n\n-------------------------------------------------------------------------\n-- Carpeta Badges\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_badges/m_badges-00001.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_badges3(\n    Id int,\n    Name nvarchar(50),\n    UserId int,\n    Date DATE\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_badges/m_badges-00001.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_badges3\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_badges3\nWITH (\n    LOCATION = '/business/b_sharedknow/b_badges/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_badges3;\n\nSELECT * FROM business_knowa.bi_badges3;\n\n-------------------------------------------------------------------------\n-- Carpeta Comments\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_comments/m_comments-00002.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_comments2(\n    Id int,\n    CreationDate DATE,\n    PostId int,\n    Score int,\n    UserId int\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_comments/m_comments-00002.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_comments2\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_comments2\nWITH (\n    LOCATION = '/business/b_sharedknow/b_comments/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_comments2;\n\nSELECT * FROM business_knowa.bi_comments2;\n\n-------------------------------------------------------------------------\n-- Carpeta Linkypes\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_linktypes/m_linktypes-00001.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_linktypes(\n    Id int,\n    Type nvarchar(20)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_linktypes/m_linktypes-00001.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_linktypes\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_linktypes\nWITH (\n    LOCATION = '/business/b_sharedknow/b_linktypes/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_linktypes;\n\nSELECT * FROM business_knowa.bi_linktypes;\n\n-------------------------------------------------------------------------\n-- Carpeta Postlinks\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_postlinks/m_postlinks-00002.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_postlinks(\n    Id int,\n    CreationDate DATE,\n    PostId int,\n    RelatedPostId int,\n    LinkTypeId int\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_postlinks/m_postlinks-00002.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_postlinks\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_postlinks\nWITH (\n    LOCATION = '/business/b_sharedknow/b_postlinks',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_postlinks;\n\nSELECT * FROM business_knowa.bi_postlinks;\n\n-------------------------------------------------------------------------\n-- Carpeta Posts1\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_posts/m_2008-01-01/m_posts_200801-00002.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_posts1_3(\n    Id int,\n    AcceptedAnswerId int,\n    AnswerCount int,\n    ClosedDate DATE,\n    CommentCount int,\n    CommunityOwnedDate DATE,\n    CreationDate DATE,\n    FavoriteCount int,\n    LastActivityDate DATE,\n    LastEditDate DATE,\n    LastEditorUserId int,\n    OwnerUserId int,\n    ParentId int,\n    PostTypeId int,\n    Score int,\n    Tags nvarchar(500),\n    ViewCount int\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_posts/m_2008-01-01/m_posts_200801-00002.parquet',,\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_posts1_3\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_posts2\nWITH (\n    LOCATION = '/business/b_sharedknow/b_posts/b_2008-01-01/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_posts1_3;\n\nSELECT * FROM business_knowa.bi_posts2;\n\n-------------------------------------------------------------------------\n-- Carpeta Posts2\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_posts/m_2009-01-01/m_posts_200901-00002.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_posts2_(\n    Id int,\n    AcceptedAnswerId int,\n    AnswerCount int,\n    ClosedDate DATE,\n    CommentCount int,\n    CommunityOwnedDate DATE,\n    CreationDate DATE,\n    FavoriteCount int,\n    LastActivityDate DATE,\n    LastEditDate DATE,\n    LastEditorUserId int,\n    OwnerUserId int,\n    ParentId int,\n    PostTypeId int,\n    Score int,\n    Tags nvarchar(500),\n    ViewCount int\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_posts/m_2009-01-01/m_posts_200901-00002.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_posts2_\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_posts2_1\nWITH (\n    LOCATION = '/business/b_sharedknow/b_posts/b_2009-01-01/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_posts2_;\n\nSELECT * FROM business_knowa.bi_posts2_1\n\n-------------------------------------------------------------------------\n-- Carpeta Posttypes\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_posttypes/m_posttypes-00001.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_posttypes(\n    Id int,\n    Type nvarchar(50)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_posttypes/m_posttypes-00001.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_posttypes\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_posttypes\nWITH (\n    LOCATION = '/business/b_sharedknow/b_posttypes',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_posttypes;\n\nSELECT * FROM business_knowa.bi_posttypes;\n\n-------------------------------------------------------------------------\n-- Carpeta Users\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_users/m_users-00001.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_users(\n    Id int,\n    CreationDate DATE,\n    DownVotes int,\n    LastAccessDate DATE,\n    Reputation int,\n    UpVotes int,\n    Views int,\n    AccountId int,\n    Email nvarchar(100)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_users/m_users-00001.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_users\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_users\nWITH (\n    LOCATION = '/business/b_sharedknow/b_users',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_users;\n\nSELECT * FROM business_knowa.bi_users;\n\n-------------------------------------------------------------------------\n-- Carpeta Votes\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (100) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_votes/m_votes-00002.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_votes(\n    Id int,\n    PostId int,\n    UserId int,\n    BountyAmount int,\n    VoteTypeId int,\n    CreationDate DATE\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_votes/m_votes-00002.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_votes\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_votes\nWITH (\n    LOCATION = '/business/b_sharedknow/b_votes',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_votes;\n\nSELECT * FROM business_knowa.bi_votes;\n\n-------------------------------------------------------------------------\n-- Carpeta Votetypes\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (100) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_votetypes/m_votetypes-00001.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_votetypes(\n    Id int,\n    Name nvarchar(50)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_votetypes/m_votetypes-00001.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_votetypes\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_votetypes\nWITH (\n    LOCATION = '/business/b_sharedknow/b_votetypes',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_votetypes;\n\nSELECT * FROM business_knowa.bi_votetypes;\n\n-----------------------------------------------\n--FINAL\n-----------------------------------------------\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "updatalakehouse_business",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}