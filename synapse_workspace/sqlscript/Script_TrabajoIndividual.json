{
	"name": "Script_TrabajoIndividual",
	"properties": {
		"content": {
			"query": "CREATE DATABASE updatalakehouse_trabajo_individual;\nGO\n\nUSE updatalakehouse_trabajo_individual;\nGO\n\n-----------------------------------------------\n--Paso 2: Creacion de dataset por zona de datos\n-----------------------------------------------\nCREATE SCHEMA master_transaction AUTHORIZATION dbo;\nGO\n\nCREATE SCHEMA business_knowa AUTHORIZATION dbo;\nGO\n\n-------------------------------------------------------------------------\n--Paso 3: Asignación de clave de encriptación y formato de tablas externas\n-------------------------------------------------------------------------\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = 'p39248J#asdasdiu89yuj1k29sdd'\nGO\n\nCREATE DATABASE SCOPED CREDENTIAL UPUserIdentity WITH IDENTITY = 'SHARED ACCESS SIGNATURE',\nSECRET = '?sv=2021-12-02&ss=bfqt&srt=sco&sp=rwdlacupyx&se=2023-06-30T10:47:11Z&st=2023-04-30T02:47:11Z&spr=https&sig=ezJCBxXXS9BCWwv3OA4CRL7y7BVfumdfdnE0VrqPlGE%3D'\nGO\n\nCREATE EXTERNAL DATA SOURCE ExternalUPDataSource\nWITH (\n    LOCATION = 'https://dlsupdskuafdevi5l.dfs.core.windows.net/',\n    CREDENTIAL = UPUserIdentity\n);\nGO\n\nCREATE EXTERNAL FILE FORMAT UPParquetFileFormat \nWITH (\n    FORMAT_TYPE = PARQUET,\n    DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'\n);\nGO\n\n-------------------------------------------------------------------------\n--Paso 4: Copia de Master a Business\n-------------------------------------------------------------------------\n\n-------------------------------------------------------------------------\n-- Carpeta Badges\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_badges/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_badges(\n    Id nvarchar(50),\n    Name nvarchar(50),\n    UserId nvarchar(50),\n    Date DATETIME\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_badges/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_badges\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_badges\nWITH (\n    LOCATION = '/business/b_sharedknow/b_badges/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_badges;\n\nSELECT TOP(100) * FROM business_knowa.bi_badges;\n\n-------------------------------------------------------------------------\n-- Carpeta Comments\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_comments/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_comments(\n    Id nvarchar(50),\n    CreationDate DATETIME,\n    PostId nvarchar(50),\n    Score int,\n    UserId nvarchar(50)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_comments/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_comments\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_comments\nWITH (\n    LOCATION = '/business/b_sharedknow/b_comments/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_comments;\n\nSELECT TOP(100) * FROM business_knowa.bi_comments;\n\n-------------------------------------------------------------------------\n-- Carpeta Linkypes\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_linktypes/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_linktypes(\n    Id nvarchar(50),\n    Type nvarchar(50)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_linktypes/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_linktypes\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_linktypes\nWITH (\n    LOCATION = '/business/b_sharedknow/b_linktypes/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_linktypes;\n\nSELECT TOP(100) * FROM business_knowa.bi_linktypes;\n\n-------------------------------------------------------------------------\n-- Carpeta Postlinks\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_postlinks/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_postlinks(\n    Id nvarchar(50),\n    CreationDate DATETIME,\n    PostId nvarchar(50),\n    RelatedPostId nvarchar(50),\n    LinkTypeId nvarchar(50)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_postlinks/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_postlinks\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_postlinks\nWITH (\n    LOCATION = '/business/b_sharedknow/b_postlinks',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_postlinks;\n\nSELECT TOP(100) * FROM business_knowa.bi_postlinks;\n\n-------------------------------------------------------------------------\n-- Carpeta Posts1\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_posts/m_2008-01-01/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_posts1(\n    Id nvarchar(50),\n    AcceptedAnswerId nvarchar(50),\n    AnswerCount int,\n    ClosedDate DATETIME,\n    CommentCount int,\n    CommunityOwnedDate DATETIME,\n    CreationDate DATETIME,\n    FavoriteCount int,\n    LastActivityDate DATETIME,\n    LastEditDate DATETIME,\n    LastEditorUserId nvarchar(50),\n    OwnerUserId nvarchar(50),\n    ParentId nvarchar(50),\n    PostTypeId nvarchar(50),\n    Score int,\n    Tags nvarchar(500),\n    ViewCount int\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_posts/m_2008-01-01/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_posts1\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_posts1\nWITH (\n    LOCATION = '/business/b_sharedknow/b_posts/b_2008-01-01/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_posts1;\n\nSELECT TOP(100) * FROM business_knowa.bi_posts1;\n\n-------------------------------------------------------------------------\n-- Carpeta Posts2\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_posts/m_2009-01-01/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_posts2(\n    Id nvarchar(50),\n    AcceptedAnswerId nvarchar(50),\n    AnswerCount int,\n    ClosedDate DATETIME,\n    CommentCount int,\n    CommunityOwnedDate DATETIME,\n    CreationDate DATETIME,\n    FavoriteCount int,\n    LastActivityDate DATETIME,\n    LastEditDate DATETIME,\n    LastEditorUserId nvarchar(50),\n    OwnerUserId nvarchar(50),\n    ParentId nvarchar(50),\n    PostTypeId nvarchar(50),\n    Score int,\n    Tags nvarchar(500),\n    ViewCount int\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_posts/m_2009-01-01/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_posts2\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_posts2\nWITH (\n    LOCATION = '/business/b_sharedknow/b_posts/b_2009-01-01/',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_posts2;\n\nSELECT TOP(100) * FROM business_knowa.bi_posts2\n\n-------------------------------------------------------------------------\n-- Carpeta Posttypes\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_posttypes/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_posttypes(\n    Id nvarchar(50),\n    Type nvarchar(50)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_posttypes/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_posttypes\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_posttypes\nWITH (\n    LOCATION = '/business/b_sharedknow/b_posttypes',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_posttypes;\n\nSELECT TOP(100) * FROM business_knowa.bi_posttypes;\n\n-------------------------------------------------------------------------\n-- Carpeta Users\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (10) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_users/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_users(\n    Id nvarchar(50),\n    CreationDate DATETIME,\n    DownVotes int,\n    LastAccessDate DATETIME,\n    Reputation int,\n    UpVotes int,\n    Views int,\n    AccountId nvarchar(50),\n    Email nvarchar(100)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_users/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_users\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_users\nWITH (\n    LOCATION = '/business/b_sharedknow/b_users',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_users;\n\nSELECT TOP(100) * FROM business_knowa.bi_users;\n\n-------------------------------------------------------------------------\n-- Carpeta Votes\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (100) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_votes/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_votes(\n    Id nvarchar(50),\n    PostId nvarchar(50),\n    UserId nvarchar(50),\n    BountyAmount int,\n    VoteTypeId nvarchar(50),\n    CreationDate DATETIME\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_votes/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_votes\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_votes\nWITH (\n    LOCATION = '/business/b_sharedknow/b_votes',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_votes;\n\nSELECT TOP(100) * FROM business_knowa.bi_votes;\n\n-------------------------------------------------------------------------\n-- Carpeta Votetypes\n-----------------------------------------------\n--Paso 01\n-----------------------------------------------\nSELECT TOP (100) *\nFrom OPENROWSET (BULK '/master/data/m_sharedknow/m_votetypes/*.parquet',\nDATA_SOURCE= 'ExternalUPDataSource',\nFORMAT ='PARQUET')  AS [file]\nGO;\n-----------------------------------------------\n--Paso 02\n-----------------------------------------------\nCREATE EXTERNAL TABLE master_transaction.dim_business_votetypes(\n    Id nvarchar(50),\n    Name nvarchar(50)\n)\n WITH (\n     LOCATION = '/master/data/m_sharedknow/m_votetypes/*.parquet',\n     DATA_SOURCE = ExternalUPDataSource,  \n     FILE_FORMAT = UPParquetFileFormat\n )\nGO\n-----------------------------------------------\n--Paso 03 -- Validación\n-----------------------------------------------\nSELECT TOP(100) * FROM master_transaction.dim_business_votetypes\n-----------------------------------------------\n--Paso 04\n-----------------------------------------------\nCREATE EXTERNAL TABLE business_knowa.bi_votetypes\nWITH (\n    LOCATION = '/business/b_sharedknow/b_votetypes',\n    DATA_SOURCE = ExternalUPDataSource,  \n    FILE_FORMAT = UPParquetFileFormat\n) AS \nSELECT * FROM master_transaction.dim_business_votetypes;\n\nSELECT TOP(100) * FROM business_knowa.bi_votetypes;\n\n-----------------------------------------------\n--FINAL\n-----------------------------------------------\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "updatalakehouse_trabajo_individual3",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}